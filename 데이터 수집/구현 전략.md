### 🚀 **시장별 자금 흐름 추적 시스템 - 구현 전략**  

---

## 🏗 **1. 개요**

이 시스템은 금융 시장(주식, 채권, 외환, 암호화폐, 원자재, 부동산)의 데이터를 10년간 월 단위로 수집하여 **시장 간 자금 흐름을 분석하는 것**이 목표다. 데이터를 API에서 가져오고 변환하여 **Parquet 파일로 저장**하며, 진행 상태를 추적하여 중단 시에도 이어서 실행할 수 있도록 한다.

✅ **각 시장별 모듈을 독립적으로 운영하여 유지보수 용이성 확보**  
✅ **진행 상태(`resume_tracker.json`)를 활용하여 중단된 부분부터 재개 가능**  
✅ **API 호출 최적화 및 에러 핸들링을 포함한 견고한 시스템 구축**  
✅ **테스트 코드를 포함하여 데이터 무결성 및 정상 동작 보장**  

---

## 📍 **2. 주요 기능 및 구현 방식**

### 🛠 **(1) 개별 시장 데이터 수집 모듈**  

각 시장별로 별도의 모듈(`fetch_*.py`)을 작성하여 API를 호출하고 데이터를 가져온다.

- **구현 방식**  
  1️⃣ `fetch_stocks.py` (주식 데이터 수집) → Yahoo Finance API 호출  
  2️⃣ `fetch_bonds.py` (채권 데이터 수집) → FRED API 호출  
  3️⃣ `fetch_forex.py` (외환 데이터 수집) → Forex API 호출  
  4️⃣ `fetch_crypto.py` (암호화폐 데이터 수집) → Binance API 호출  
  5️⃣ `fetch_commodities.py` (원자재 데이터 수집) → Quandl API 호출  
  6️⃣ `fetch_real_estate.py` (부동산 데이터 수집) → Zillow API 호출  

✅ **테스트 포함**: API 응답 형식이 예상과 일치하는지 검증 (JSON 구조 확인)  
✅ **에러 처리**: API 호출 실패 시 일정 시간 대기 후 재시도  

---

### 🛠 **(2) 데이터 변환 및 전처리 (`transform_data.py`)**  

- **역할**: API에서 가져온 데이터를 Parquet 형식에 맞게 변환 및 정리
- **구현 방식**:
  1️⃣ 불필요한 데이터 필터링 (예: 중복 값 제거, 결측값 처리)  
  2️⃣ 날짜 형식 변환 및 정렬  
  3️⃣ 주요 컬럼 통일 (예: 가격 컬럼명 `price`, 거래량 `volume` 등)  

✅ **테스트 포함**: 데이터 변환 후 무결성 검증 (예: NaN 값 체크, 데이터 타입 검증)  

---

### 🛠 **(3) 데이터 저장 (`save_data.py`)**  

- **역할**: 변환된 데이터를 개별 Parquet 파일로 저장
- **구현 방식**:
  1️⃣ 시장별 파일(`stocks.parquet`, `bonds.parquet`, 등) 생성 및 업데이트  
  2️⃣ 기존 데이터가 있을 경우 자동 병합 후 저장  

✅ **테스트 포함**: 저장된 Parquet 파일이 정상적으로 로드되는지 확인  

---

### 🛠 **(4) 진행 상태 추적 (`resume_tracker.py`)**  

- **역할**: 마지막으로 수집한 날짜를 기록하여 중단 시 이어서 실행 가능하도록 함  
- **구현 방식**:
  1️⃣ `resume_tracker.json` 파일을 사용해 각 시장별 마지막 수집 날짜 기록  
  2️⃣ 프로그램 실행 시 해당 파일을 확인하여 필요한 데이터만 요청  
  3️⃣ 새로운 데이터가 수집될 때마다 업데이트  

✅ **테스트 포함**: `resume_tracker.json` 업데이트가 정상적으로 이루어지는지 검증  

---

## 📂 **3. 디렉터리 구조**

```plaintext
project_root/
│── data/  ⬅️ **수집된 데이터 (Parquet 형식) 저장**
│   ├── stocks.parquet  
│   ├── bonds.parquet  
│   ├── forex.parquet  
│   ├── crypto.parquet  
│   ├── commodities.parquet  
│   ├── real_estate.parquet  
│── src/  ⬅️ **코드 모듈**
│   ├── fetch_modules/  ⬅️ **시장별 API 호출 모듈**
│   │   ├── fetch_stocks.py  
│   │   ├── fetch_bonds.py  
│   │   ├── fetch_forex.py  
│   │   ├── fetch_crypto.py  
│   │   ├── fetch_commodities.py  
│   │   ├── fetch_real_estate.py  
│   ├── transform_data.py  ⬅️ **데이터 변환 및 전처리**
│   ├── save_data.py  ⬅️ **데이터 저장 모듈**
│   ├── resume_tracker.py  ⬅️ **진행 상태 추적**
│── logs/  ⬅️ **오류 로그 기록**
│   ├── error_log.txt  
│── main.py  ⬅️ **전체 실행 스크립트**
```
✅ **테스트 포함**: 각 모듈 실행 후 데이터 저장 및 상태 추적 기능 검증  

---

## 🚀 **4. 실행 흐름**

1️⃣ **Main 실행 (`main.py`)** → 개별 시장별 수집 모듈 호출  
2️⃣ **`resume_tracker.json` 확인** → 마지막 수집 날짜 이후 데이터만 요청  
3️⃣ **API 요청 & 데이터 변환** → JSON 응답을 Parquet 포맷으로 변환  
4️⃣ **데이터 저장 & 병합** → 기존 데이터와 새로운 데이터 병합 후 저장  
5️⃣ **진행 상태 업데이트** → `resume_tracker.json` 최신 상태 반영  
6️⃣ **로그 기록** → 오류 발생 시 `error_log.txt`에 저장  

✅ **테스트 포함**: 전체 실행 후 데이터 저장, 변환, 상태 추적 기능이 정상 동작하는지 검증  

---

## 🎯 **5. 최종 목표**

이 시스템을 통해 **각 시장의 자금 흐름을 분석하여 시장 간 이동 패턴을 파악**하고, 이를 기반으로 금융 시장의 트렌드를 예측할 수 있다.

🔹 **자금이 어디에서 어디로 이동하는지 분석**  
🔹 **금융 시장 간 상관관계 파악 및 트렌드 예측**  
🔹 **장기적인 투자 전략 및 시장 변화 대응 전략 수립**  

🚀 **이제 구현을 시작하면 금융 시장의 흐름을 한눈에 파악할 수 있는 강력한 분석 도구가 될 것!**

