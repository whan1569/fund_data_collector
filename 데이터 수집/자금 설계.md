### 📌 **시장별 자금 흐름 추적 시스템 설계**  

---

## 🏗 **1. 개요 및 목표**  

### 📍 **🎯 목표**  
✅ 주식, 채권, 외환, 암호화폐, 원자재, 부동산 시장에서 데이터를 수집하여 **월간 단위로 Parquet 저장**  
✅ **API 호출 제한을 고려한 최적화된 요청 방식** 적용  
✅ **진행 상태(엔드포인트) 기록**을 통해 중단 시 이어서 수집 가능  
✅ **데이터 저장 방식 통일 및 자동 병합**  
✅ **각 시장의 총자금 흐름을 분석하여 시장 간 자금 이동 패턴을 파악**  

---

## 📍 **2. 주요 데이터 항목 및 시장 정보**  

| **시장**   | **수집 데이터**                 | **출처 (API)**           | **수집 빈도** |  
|-----------|--------------------------------|-------------------------|--------------|  
| **주식 시장**  | 종가, 거래량                     | Yahoo Finance API       | 월간         |  
| **채권 시장**  | 국채 금리, 회사채 스프레드       | FRED API                | 월간         |  
| **외환 시장**  | USD, EUR 등 주요 통화 환율       | Forex API               | 월간         |  
| **암호화폐 시장** | BTC, ETH 가격 및 거래량         | Binance API             | 월간         |  
| **원자재 시장** | 금, 원유, 산업 금속 가격         | Quandl API              | 월간         |  
| **부동산 시장** | 글로벌 부동산 지수               | Zillow API              | 월간         |  

---

## 📍 **3. 시스템 아키텍처**  

```plaintext
┌────────────────────────┐
│       Main Script      │
│        (main.py)       │
└──────────┬────────────┘
           │
┌──────────▼───────────┐
│  개별 데이터 수집 모듈 │
│  (fetch_modules/)     │
└──────────┬───────────┘
           │
┌──────────▼───────────┐
│  Data Transform      │
│  (transform_data.py) │
└──────────┬───────────┘
           │
┌──────────▼───────────┐
│   Data Save Module   │
│   (save_data.py)     │
└──────────┬───────────┘
           │
┌──────────▼───────────┐
│     Parquet Files    │
│      (data/*.parquet)│
└──────────────────────┘
```

---

## 📍 **4. 데이터 수집 흐름 (Cursor 방식 적용)**  
1️⃣ **`resume_tracker.json`에서 마지막 수집 날짜 확인**  
2️⃣ **해당 날짜부터 API 호출하여 월 단위 데이터 요청**  
3️⃣ **API 호출 제한 초과 시 대기 후 재시도**  
4️⃣ **응답 데이터를 변환 후 Parquet 저장**  
5️⃣ **진행 상태(마지막 수집 날짜) `resume_tracker.json` 업데이트**  
6️⃣ **모든 데이터 수집 완료 후 종료**  

---

## 📍 **5. 데이터 저장 및 관리 방식**  

### 📂 **디렉터리 구조**  
```plaintext
project_root/
│── data/  
│   ├── stocks.parquet  
│   ├── bonds.parquet  
│   ├── forex.parquet  
│   ├── crypto.parquet  
│   ├── commodities.parquet  
│   ├── real_estate.parquet  
│── src/  
│   ├── fetch_modules/  ⬅️ **시장별 데이터 수집 모듈 디렉터리**  
│   │   ├── fetch_stocks.py  
│   │   ├── fetch_bonds.py  
│   │   ├── fetch_forex.py  
│   │   ├── fetch_crypto.py  
│   │   ├── fetch_commodities.py  
│   │   ├── fetch_real_estate.py  
│   ├── transform_data.py  
│   ├── save_data.py  
│   ├── resume_tracker.py  ⬅️ **진행 상태 저장 모듈**  
│── logs/  
│   ├── error_log.txt  ⬅️ **API 오류 발생 시 기록**  
│── main.py  
```

---

## 📍 **6. 시장별 데이터 수집 모듈 (분리된 API 모듈)**  

✅ **각 시장별 데이터 수집 모듈을 분리하여 유지보수 편의성 향상**  

| **시장**   | **모듈명**             | **설명**  |
|-----------|---------------------|--------|
| **주식 시장**  | fetch_stocks.py    | 주식 종가 및 거래량 수집 |
| **채권 시장**  | fetch_bonds.py     | 국채 금리 및 회사채 스프레드 수집 |
| **외환 시장**  | fetch_forex.py     | 주요 통화 환율 수집 |
| **암호화폐 시장** | fetch_crypto.py    | BTC, ETH 가격 및 거래량 수집 |
| **원자재 시장** | fetch_commodities.py | 금, 원유, 산업 금속 가격 수집 |
| **부동산 시장** | fetch_real_estate.py | 글로벌 부동산 지수 수집 |

✅ **각 모듈은 개별적으로 실행 가능하며, 필요 시 병렬 처리 적용 가능**  

---

## 🚀 **최종 설계 요약**  

### 🔹 **시장별 자금 흐름 분석 목표**  
✅ 각 시장의 **총자금 흐름을 추적**하여 **시장 간 자금 이동 패턴을 파악**  
✅ **각 시장의 데이터 수집을 최적화**하여 정확한 흐름 분석 가능  
✅ **분석된 데이터를 기반으로 금융 시장의 트렌드 예측**  

### 🔹 **데이터 수집 자동화 설계**  
✅ 각 시장별 데이터를 10년간 월 단위로 수집  
✅ API 호출 횟수 제한을 고려하여 대기 및 재시도 전략 적용  
✅ 중단되면 마지막 수집 위치부터 다시 시작 (`resume_tracker.json`)  
✅ 데이터를 개별 Parquet 파일로 저장하여 관리  
✅ 필요 시 `pandas`를 활용해 병합 및 분석 가능  

### 🔹 **최적화 및 보안**  
✅ 비동기 처리 (`asyncio`)로 여러 API 요청을 동시에 실행  
✅ 환경 변수 (`.env`)를 활용해 API Key를 안전하게 관리  
✅ 로그 시스템 (`logs/error_log.txt`)으로 오류 발생 시 추적 가능  

🚀 **이제 데이터 수집을 실행하고 시장 간 자금 이동 흐름을 분석하면 금융 시장의 트렌드를 예측할 수 있음!**

